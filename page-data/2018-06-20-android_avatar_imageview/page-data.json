{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2018-06-20-android_avatar_imageview/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Aris's Blog"}},"markdownRemark":{"id":"11ce7274-3395-5d00-81e1-0dac462f277e","excerpt":"In this post I’m gonna create an circle avatar image custom view which is a subclass of circle image view, so before start reading this, make sure you’ve read…","html":"<p>In this post I’m gonna create an circle avatar image custom view which is a subclass of circle image view, so before start reading this, make sure you’ve read and understand the post about [Creating Custom Circle Image View]({% post_url 2018-06-06-circle_image_view %}).</p>\n<p>This is how circle avatar image view looks like.</p>\n<p><img src=\"/9cbee13892c0e8809649d077e455dc4f/figure.gif\" alt=\"figure1\"></p>\n<p>It can show either an image or initial character.</p>\n<!--more-->\n<p>The project is available <a href=\"https://github.com/abdularis/CircularImageView\">here on Github</a></p>\n<h2>Reuse CircleImageView</h2>\n<p>Extend the <code class=\"language-text\">CircleImageView</code> class to reuse the functionality. Define two static final integer to represent two state for either showing an initial or an image.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AvatarImageView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CircleImageView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> SHOW_INITIAL <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> SHOW_IMAGE <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Define XML Attributes</h2>\n<p>This attributes is used to customize the view in xml layout.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>declare-styleable</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>AvatarImageView<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>attr</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>avatarBackgroundColor<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">format</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>color<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>attr</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>textSize<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">format</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dimension<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>attr</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>textColor<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">format</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>color<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>attr</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">format</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>string<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>attr</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>state<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">format</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>enum<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>enum</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>INITIAL<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>enum</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IMAGE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>attr</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>declare-styleable</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2>Define member variables</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AvatarImageView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CircleImageView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Paint</span> mTextPaint<span class=\"token punctuation\">;</span> <span class=\"token comment\">// used to draw a text/initial character</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Rect</span> mTextBounds<span class=\"token punctuation\">;</span> <span class=\"token comment\">// rectangle bounds of initial character</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Paint</span> mBackgroundPaint<span class=\"token punctuation\">;</span> <span class=\"token comment\">// used to draw filled circle for text/initial background</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RectF</span> mBackgroundBounds<span class=\"token punctuation\">;</span> <span class=\"token comment\">// bounds of the circle</span>\n\n    <span class=\"token annotation punctuation\">@NonNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> mInitial<span class=\"token punctuation\">;</span> <span class=\"token comment\">// holding a character to be drawn</span>\n    <span class=\"token annotation punctuation\">@NonNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> mText<span class=\"token punctuation\">;</span> <span class=\"token comment\">// holding whole text (in case we need it)</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> mShowState<span class=\"token punctuation\">;</span> <span class=\"token comment\">// the current state of avatar view</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Important methods</h2>\n<p>These are explanations of some methods that I consider more important.</p>\n<h3>Updating background circle bounds</h3>\n<p>When the view size changed the <code class=\"language-text\">mBackgroundBounds</code> needs to be updated to make size and position of bounds correct by calling the super class method <code class=\"language-text\">updateCircleDrawBounds()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AvatarImageView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CircleImageView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onSizeChanged</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> w<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> h<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> oldw<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> oldh<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onSizeChanged</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">,</span> oldw<span class=\"token punctuation\">,</span> oldh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">updateCircleDrawBounds</span><span class=\"token punctuation\">(</span>mBackgroundBounds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Updating text bounds</h3>\n<p>Bounds or dimension of a character is needed to calculate the correct position for the character to be rendered in the center.\nThis method would be called when the text changed, for example inside the setter method for text or text size and in constructor for initialization.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AvatarImageView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CircleImageView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateTextBounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        mTextPaint<span class=\"token punctuation\">.</span><span class=\"token function\">getTextBounds</span><span class=\"token punctuation\">(</span>mInitial<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> mInitial<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mTextBounds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Drawing</h3>\n<p>If the state is <code class=\"language-text\">SHOW_IMAGE</code> then render straightly using parent <code class=\"language-text\">onDraw()</code> method.\nIf it’s <code class=\"language-text\">SHOW_INITIAL</code> then render the text and background.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AvatarImageView</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CircleImageView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onDraw</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Canvas</span> canvas<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mShowState <span class=\"token operator\">==</span> SHOW_INITIAL<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        \t<span class=\"token comment\">// this is centered y coordinate for text</span>\n            <span class=\"token keyword\">float</span> textBottom <span class=\"token operator\">=</span> mBackgroundBounds<span class=\"token punctuation\">.</span><span class=\"token function\">centerY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> mTextBounds<span class=\"token punctuation\">.</span><span class=\"token function\">exactCenterY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            canvas<span class=\"token punctuation\">.</span><span class=\"token function\">drawOval</span><span class=\"token punctuation\">(</span>mBackgroundBounds<span class=\"token punctuation\">,</span> mBackgroundPaint<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            canvas<span class=\"token punctuation\">.</span><span class=\"token function\">drawText</span><span class=\"token punctuation\">(</span>mInitial<span class=\"token punctuation\">,</span> mBackgroundBounds<span class=\"token punctuation\">.</span><span class=\"token function\">centerX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> textBottom<span class=\"token punctuation\">,</span> mTextPaint<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">drawStroke</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">drawHighlight</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onDraw</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Extending Circle Image View to Create Circle Avatar Image View","date":"June 20, 2018","description":null}},"previous":{"fields":{"slug":"/2018-06-06-android_circle_imageview/"},"frontmatter":{"title":"Creating Custom Circle Image View for Android"}},"next":{"fields":{"slug":"/2018-06-21-scroll_position_android/"},"frontmatter":{"title":"Save and Restore ScrollView and RecyclerView Scroll Position in Android"}}},"pageContext":{"id":"11ce7274-3395-5d00-81e1-0dac462f277e","previousPostId":"b8286044-8421-5883-82e4-8820f4937c68","nextPostId":"eb76d227-4bf3-5fd7-a51b-42d3d018a632"}},
    "staticQueryHashes": ["2841359383","3257411868"]}